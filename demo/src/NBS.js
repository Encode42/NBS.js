(()=>{"use strict";var n={174:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var s=n(r(708)),i=n(r(365)),o=n(r(917)),n=n(r(91)),r=r(381);function a(){}(e.default=a).Song=s.default,a.Layer=i.default,a.Note=o.default,a.Instrument=n.default,a.getLayerClass=r.getLayerClass,a.getNoteClass=r.getNoteClass,a.getInstrumentClass=r.getInstrumentClass,a.setLayerClass=r.setLayerClass,a.setNoteClass=r.setNoteClass,a.setInstrumentClass=r.setInstrumentClass},91:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(t,e,r){this.name="",this.audioSrc="",this.key=45,this.builtIn=!1,this.pressKey=!1,this.name=t,this.id=e,this.audioSrc=(null==r?void 0:r.audioSrc)||"",this.key=void 0===(null==r?void 0:r.key)?45:r.key,this.builtIn=null!==(e=null==r?void 0:r.builtIn)&&void 0!==e&&e,this.pressKey=null!==(r=null==r?void 0:r.pressKey)&&void 0!==r&&r}}(e=e.default=r).builtIn=[new e("Harp",0,{builtIn:!0}),new e("Double Bass",1,{builtIn:!0}),new e("Bass Drum",2,{builtIn:!0}),new e("Snare Drum",3,{builtIn:!0}),new e("Click",4,{builtIn:!0}),new e("Guitar",5,{builtIn:!0}),new e("Flute",6,{builtIn:!0}),new e("Bell",7,{builtIn:!0}),new e("Chime",8,{builtIn:!0}),new e("Xylophone",9,{builtIn:!0}),new e("Iron Xylophone",10,{builtIn:!0}),new e("Cow Bell",11,{builtIn:!0}),new e("Didgeridoo",12,{builtIn:!0}),new e("Bit",13,{builtIn:!0}),new e("Banjo",14,{builtIn:!0}),new e("Pling",15,{builtIn:!0})]},365:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0});const o=r(381);e.default=class{constructor(t){this.name="",this.velocity=100,this.panning=0,this.locked=!1,this.solo=!1,this.notes=[],this.id=t}setNote(t,e){return this.notes[t]=e}addNote(t,e,r,n,s,i){i=new((0,o.getNoteClass)())(e,r,n,s,i);return this.setNote(t,i)}deleteNote(t){delete this.notes[t]}}},917:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=n(r(91));e.default=class{constructor(t,e,r,n,s){this.instrument=null!=t?t:i.default.builtIn[0],this.key=null!=e?e:45,this.panning=null!=r?r:0,this.velocity=null!=n?n:100,this.pitch=null!=s?s:0}}},708:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const s=r(381),i=n(r(867)),o=n(r(736));e.default=class{constructor(){this.size=0,this.name="",this.author="",this.originalAuthor="",this.description="",this.midiName="",this.tempo=10,this.timeSignature=4,this.loopEnabled=!1,this.maxLoopCount=0,this.loopStartTick=0,this.autoSaveEnabled=!1,this.autoSaveDuration=5,this.minutesSpent=0,this.leftClicks=0,this.rightClicks=0,this.blocksAdded=0,this.blocksRemoved=0,this.hasSolo=!1,this.nbsVersion=5,this.firstCustomIndex=this.instruments.length,this.layers=[],this.errors=[]}get instruments(){return(0,s.getInstrumentClass)().builtIn}get timePerTick(){return 20/this.tempo*50}get endTime(){return this.size*this.timePerTick}addLayer(){var t=new((0,s.getLayerClass)())(this.layers.length+1);return this.layers.push(t),t}setNote(t,e,r){this.expand(e),t.setNote(e,r)}addNote(t,e,r,n,s,i,o){return this.expand(e),t.addNote(e,r,n,s,i,o)}deleteLayer(t){this.layers.splice(this.layers.indexOf(t),1)}toArrayBuffer(){return(0,o.default)(this)}static toArrayBuffer(t){return(0,o.default)(t)}static fromArrayBuffer(t){return(0,i.default)(t)}expand(t){t+1>this.size&&(this.size=t+1)}}},867:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const u=r(381),d=n(r(708));e.default=function(i){const o=new d.default;try{const a=new u.BufferReader(i);let t=a.readShort();0===t&&(o.nbsVersion=a.readByte(),o.firstCustomIndex=a.readByte(),3<=o.nbsVersion&&(t=a.readShort()));const d=a.readShort();o.name=a.readString(),o.author=a.readString(),o.originalAuthor=a.readString(),o.description=a.readString(),o.tempo=a.readShort()/100,o.autoSaveEnabled=Boolean(a.readByte()),o.autoSaveDuration=a.readByte(),o.timeSignature=a.readByte(),o.minutesSpent=a.readInt(),o.leftClicks=a.readInt(),o.rightClicks=a.readInt(),o.blocksAdded=a.readInt(),o.blocksRemoved=a.readInt(),o.midiName=a.readString(),4<=o.nbsVersion&&(o.loopEnabled=Boolean(a.readByte()),o.maxLoopCount=a.readByte(),o.loopStartTick=a.readShort());const l=[];let s=-1;for(;;){const i=a.readShort();if(0===i)break;s+=i;let n=-1;for(;;){const i=a.readShort();if(0===i)break;n+=i;const u=a.readByte(),d=a.readByte();let t=100,e=100,r=0;4<=o.nbsVersion&&(t=a.readByte(),e=a.readUnsingedByte()-100,r=a.readShort()),l.push({instrument:u,key:d,velocity:t,panning:e,pitch:r,layer:n,tick:s})}}if(0<o.nbsVersion&&o.nbsVersion<3&&(t=s),o.size=t,i.byteLength>a.currentByte)for(let t=0;t<d;t++){const i=o.addLayer();var e;i.name=a.readString(),4<=o.nbsVersion&&(1===(e=a.readByte())&&(i.locked=!0),2===e&&(i.solo=o.hasSolo=!0)),i.velocity=a.readByte();let t=0;2<=o.nbsVersion&&(t=a.readUnsingedByte()-100),i.panning=t}var r=a.readByte();for(let t=0;t<r;t++)o.instruments.push(new((0,u.getInstrumentClass)())(a.readString(),o.instruments.length,{audioSrc:a.readString(),key:a.readByte(),pressKey:Boolean(a.readByte())}));for(const i of l){i.layer>=o.layers.length&&o.addLayer();var n=o.layers[i.layer];o.addNote(n,i.tick,o.instruments[i.instrument],i.key,i.panning,i.velocity,i.pitch)}}catch(i){o.errors.push(String(i))}return o}},736:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0});const l=r(381);function n(s,e,i=!1){const o=new l.BufferWriter(new ArrayBuffer(e),i);try{1<=s.nbsVersion&&(o.writeShort(0),o.writeByte(s.nbsVersion),o.writeByte(s.firstCustomIndex)),(0===s.nbsVersion||3<=s.nbsVersion)&&o.writeShort(s.size),o.writeShort(s.layers.length),o.writeString(s.name),o.writeString(s.author),o.writeString(s.originalAuthor),o.writeString(s.description),o.writeShort(100*s.tempo),o.writeByte(+s.autoSaveEnabled),o.writeByte(s.autoSaveDuration),o.writeByte(s.timeSignature),o.writeInt(Math.floor(s.minutesSpent)),o.writeInt(s.leftClicks),o.writeInt(s.rightClicks),o.writeInt(s.blocksAdded),o.writeInt(s.blocksRemoved),o.writeString(s.midiName),4<=s.nbsVersion&&(o.writeByte(+s.loopEnabled),o.writeByte(s.maxLoopCount),o.writeByte(s.loopStartTick)),o.writeByte(0);let n=-1;for(let r=0;r<=s.size;r++){let t=!1;for(const e of s.layers)if(e.notes[r]){t=!0;break}if(t){var a=r-n;n=r,o.writeShort(a);let e=-1;for(let t=0;t<s.layers.length;t++){const l=s.layers[t].notes[r];if(l){const i=t-e;e=t,o.writeShort(i),o.writeByte(l.instrument.id),o.writeByte(l.key),4<=s.nbsVersion&&(o.writeByte(l.velocity),o.writeUnsignedByte(l.panning+100),o.writeShort(l.pitch))}}o.writeShort(0)}}o.writeShort(0);for(const e of s.layers){if(o.writeString(e.name),4<=s.nbsVersion){let t=0;e.locked&&(t=1),e.solo&&(t=2),o.writeByte(t)}o.writeByte(e.velocity),2<=s.nbsVersion&&o.writeByte(e.panning+100)}o.writeByte(s.instruments.length-s.firstCustomIndex);for(let t=0;t<s.instruments.length;t++){const i=s.instruments[t];i.builtIn||(o.writeString(i.name),o.writeString(i.audioSrc),o.writeByte(i.key),o.writeByte(+i.pressKey))}}catch(e){s.errors.push(String(e))}return o}e.default=function(t){var e=n(t,0,!0).currentByte;return n(t,e).buffer}},381:function(t,e,r){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.setInstrumentClass=e.setNoteClass=e.setLayerClass=e.getInstrumentClass=e.getNoteClass=e.getLayerClass=e.BufferWriter=e.BufferReader=void 0;var s=n(r(91)),i=n(r(917)),r=n(r(365));class o{constructor(t){this.currentByte=0,this.buffer=t,this.viewer=new DataView(t)}}e.BufferReader=class extends o{readByte(){var t=this.viewer.getInt8(this.currentByte);return this.currentByte+=1,t}readUnsingedByte(){var t=this.viewer.getUint8(this.currentByte);return this.currentByte+=1,t}readShort(){var t=this.viewer.getInt16(this.currentByte,!0);return this.currentByte+=2,t}readInt(){var t=this.viewer.getInt32(this.currentByte,!0);return this.currentByte+=4,t}readString(){const e=this.readInt();let r="";for(let t=0;t<e;t++){const e=this.readUnsingedByte();r+=String.fromCodePoint(e)}return r}},e.BufferWriter=class extends o{constructor(t,e=!1){super(t),this.dry=e}writeByte(t){this.dry||this.viewer.setInt8(this.currentByte,Math.floor(t)),this.currentByte+=1}writeUnsignedByte(t){this.dry||this.viewer.setUint8(this.currentByte,t),this.currentByte+=1}writeShort(t){this.dry||this.viewer.setInt16(this.currentByte,t,!0),this.currentByte+=2}writeInt(t){this.dry||this.viewer.setInt32(this.currentByte,t,!0),this.currentByte+=4}writeString(t){this.writeInt(t.length);for(const e of t)this.writeUnsignedByte(e.charCodeAt(0))}};let a=r.default,l=i.default,u=s.default;e.getLayerClass=function(){return a},e.setLayerClass=function(t){a=t},e.getNoteClass=function(){return l},e.setNoteClass=function(t){l=t},e.getInstrumentClass=function(){return u},e.setInstrumentClass=function(t){u=t}}},s={},t=function t(e){var r=s[e];if(void 0!==r)return r.exports;r=s[e]={exports:{}};return n[e].call(r.exports,r,r.exports,t),r.exports}(174);self.NBSjs=t.default})();